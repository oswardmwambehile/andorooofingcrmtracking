{% extends "manager/base.html" %}
{% load static %}

{% block content %}
  {% include "manager/sidebar.html" %}
  
  <div class="main-panel">
    <div class="main-header">
      {% include "manager/nav.html" %}
    </div>
    <div class="container">
      <div class="page-inner">
        <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
          <div></div>
          <div class="ms-md-auto py-2 py-md-0">
            <a href="#" class="btn btn-primary btn-round">Export Production Lines</a>
          </div>
        </div>

        <!-- Search Input -->
        <div class="row mb-4">
          <div class="col-md-12">
            <input type="text" id="search-input" class="form-control"
                   placeholder="Search production lines..." value="{{ search_query }}" />
          </div>
        </div>

        <!-- Table -->
        <div class="col-md-12">
          <div class="card">
            <div class="card-header"><h4 class="card-title">Production Lines</h4></div>
            <div class="card-body">
              <div class="table-responsive" style="overflow-x: auto;">
                <table class="table table-striped table-hover" style="min-width: 800px;">
                  <thead class="table-dark">
                    <tr>
                      <th style="white-space: nowrap;">Name</th>
                      <th style="white-space: nowrap;">Created At</th>
                      <th style="white-space: nowrap;">Updated At</th>
                      <th style="white-space: nowrap;">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for line in lines %}
                      <tr>
                        <td style="white-space: nowrap;">{{ line.name }}</td>
                        <td style="white-space: nowrap;">{{ line.created_at|date:"Y-m-d H:i" }}</td>
                        <td style="white-space: nowrap;">{{ line.updated_at|date:"Y-m-d H:i" }}</td>
                        <td style="white-space: nowrap;">
                          <a href="{% url 'manager_view_production_line_detail' line.id %}"
                             class="btn btn-primary btn-sm">View</a>
                        </td>
                      </tr>
                    {% empty %}
                      <tr>
                        <td colspan="4" class="text-center">No production lines found.</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

              <div id="no-results" style="display: none;"
                   class="alert alert-warning text-center">No results found for the search term.</div>

              {% if is_paginated %}
              <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center mt-3">
                  {% if lines.has_previous %}
                    <li class="page-item">
                      <a class="page-link" href="?page=1&q={{ request.GET.q }}">&laquo;</a>
                    </li>
                    <li class="page-item">
                      <a class="page-link"
                         href="?page={{ lines.previous_page_number }}&q={{ request.GET.q }}">&lsaquo;</a>
                    </li>
                  {% else %}
                    <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
                    <li class="page-item disabled"><span class="page-link">&lsaquo;</span></li>
                  {% endif %}

                  {% for i in lines.paginator.page_range %}
                    {% if i == lines.number %}
                      <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                    {% elif i > lines.number|add:'-3' and i < lines.number|add:'3' %}
                      <li class="page-item">
                        <a class="page-link"
                           href="?page={{ i }}&q={{ request.GET.q }}">{{ i }}</a>
                      </li>
                    {% endif %}
                  {% endfor %}

                  {% if lines.has_next %}
                    <li class="page-item">
                      <a class="page-link"
                         href="?page={{ lines.next_page_number }}&q={{ request.GET.q }}">&rsaquo;</a>
                    </li>
                    <li class="page-item">
                      <a class="page-link"
                         href="?page={{ lines.paginator.num_pages }}&q={{ request.GET.q }}">&raquo;</a>
                    </li>
                  {% else %}
                    <li class="page-item disabled"><span class="page-link">&rsaquo;</span></li>
                    <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
                  {% endif %}
                </ul>
              </nav>
              {% endif %}
            </div>
          </div>
        </div>

        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tbody tr');
            const noResults = document.getElementById('no-results');

            searchInput.addEventListener('input', () => {
              const val = searchInput.value.toLowerCase();
              let visible = false;
              rows.forEach(r => {
                const txt = r.textContent.toLowerCase();
                const match = txt.includes(val);
                r.style.display = match ? '' : 'none';
                if (match) visible = true;
              });
              noResults.style.display = visible ? 'none' : 'block';
            });
          });
        </script>

      </div>
    </div>
  </div>
{% endblock %}
